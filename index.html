---
layout: default
---
<script src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
<script src="//code.highcharts.com/highcharts.js"></script>
<script src="//code.highcharts.com/modules/exporting.js"></script>

<div class="container">
  <div class="title">
    <h1>Gemeindeinformationen für Kaltbrunn SG</h1>
    <form class="pure-form">
        <fieldset>
            <input type="text" placeholder="PLZ oder Name">
            <button type="submit" class="pure-button">Suche</button>
        </fieldset>
    </form>
  </div>
  <div class="pure-g">
    <div class="pure-u-1 pure-u-md-1-2 pure-u-lg-1-3">
      <div id="birthplaceChart" style="height: 400px;"></div>
    </div>
    <div class="pure-u-1 pure-u-md-1-2 pure-u-lg-1-3">
      <div id="ageGroupChart" style="height: 400px;"></div>
      </div>
  </div>
  <div class="grid-12 gutter-20">
    <div class="pure-u-1 pure-u-md-1-2 pure-u-lg-1-3">
      <div id="birth-chart" style="height: 400px;"></div>
    </div>
    <div class="pure-u-1 pure-u-md-1-2 pure-u-lg-1-3" id="emigrationChart" style="height: 400px; margin: 0 auto"></div>
    <div class="pure-u-1-6 pure-u-md-1-2 pure-u-lg-1-3" id="workplaceSectorChart" style="height: 400px; margin: 0 auto"></div>
    <div class="pure-u-1-6 pure-u-md-1-2 pure-u-lg-1-3" id="workplaceSizeChart" style="height: 400px; margin: 0 auto"></div>
  </div>
</div>

<script>
$(function () {
    Highcharts.theme = {
        colors: ['#006699', '#66afe9', '#D8E8EF', '#757575', '#DC0018', '#fffab2',  '##F7001D'],
        chart: {
            backgroundColor: {
                linearGradient: [0, 0, 500, 500],
                stops: [
                    [0, 'rgb(255, 255, 255)'],
                    [1, 'rgb(240, 240, 255)']
                ]
            },
        },
        title: {
            style: {
                color: '#454545',
                font: '16px "Open Sans", sans-serif'
            }
        },
        subtitle: {
            style: {
                color: '#454545',
                font: '12px "Open Sans", sans-serif'
            }
        },

        legend: {
            itemStyle: {
                color: '454545',
                font: '9pt Open Sans, sans-serif'
            },
            itemHoverStyle:{
                color: 'gray'
            }
        }
    };
    Highcharts.setOptions(Highcharts.theme);

    $.get('http://192.168.99.101:3000/communities/3313', function(data) {
    function sortByYear(a, b) {
      return a.year - b.year;
    }
    var citizenshipsSeries = $.map(data.new_citizenships.sort(sortByYear), function(record) {
      return record.citizenships;
    });
    var years = $.map(data.births.sort(sortByYear), function(record) {
      return record.year;
    });
    var birthSeries = $.map(data.births.sort(sortByYear), function(record) {
      return record.births;
    });
    var deathSeries = $.map(data.deaths.sort(sortByYear), function(record) {
      return -record.deaths;
    });
    var populationSeries = $.map(data.residential_population.sort(sortByYear), function(record) {
      return record.population;
    });
    var birthSurplusSeries = $.map(data.birth_surplus.sort(sortByYear), function(record) {
      return record.surplus;
    });

    var immigrationSeries = $.map(data.immigration.sort(sortByYear), function(record) {
      return record.immigration;
    });

    var emigrationSeries = $.map(data.emigration.sort(sortByYear), function(record) {
      return -record.emigration;
    });

    $('#immigrationChart').highcharts({
        chart: { type: 'column' },
        title: { text: 'Immigration and Emmigration' },
        xAxis: { categories: years },
        yAxis: {
            title: { text: 'People' }
        },
        series: [{
            name: 'Immigration',
            data: immigrationSeries
        }, {
            name: 'Emigration',
            data: emigrationSeries
        }]
    });

    $('#birth-chart').highcharts({
        chart: { type: 'area' },
        title: { text: 'Births and Deaths' },
        xAxis: { categories: years },
        yAxis: {
            title: { text: 'People' }
        },
        plotOptions: {
            column: { stacking: 'normal' }
        },
        series: [{
            name: 'Births',
            type: 'column',
            data: birthSeries
        }, {
            name: 'Deaths',
            type: 'column',
            data: deathSeries
        }, {
            name: 'Birth Surplus',
            type: 'spline',
            dashStyle: 'shortdot',
            color: '#DC0018',
            data: birthSurplusSeries
        }]
    });

    var foreignBirthSeries = $.map(data.population_birth_place_abroad.sort(sortByYear), function(record) {
      return record.people;
    });
    var swissBirthSeries = $.map(data.population_birth_place_switzerland.sort(sortByYear), function(record) {
      return record.people;
    });

    $('#birthplaceChart').highcharts({
        chart: { type: 'column' },
        title: { text: 'Herkunft' },
        xAxis: { categories: years },
        yAxis: {
            title: { text: 'People' }
        },
        plotOptions: {
            series: { stacking: 'normal' }
        },
        series: [{
            name: 'Schweiz',
            data: swissBirthSeries
        }, {
            name: 'Ausland',
            data: foreignBirthSeries
        }]
    });

    function ageGroupsAsArray(record) {
      return [
        record.population_5_9_years,
        record.population_10_14_years,
        record.population_15_19_years,
        record.population_20_24_years,
        record.population_25_29_years,
        record.population_30_34_years,
        record.population_35_39_years,
        record.population_40_44_years,
        record.population_45_49_years,
        record.population_50_54_years,
        record.population_55_59_years,
        record.population_60_64_years,
        record.population_65_69_years,
        record.population_70_74_years,
        record.population_75_79_years,
        record.population_80_84_years,
        record.population_85_89_years,
        record.population_90_94_years,
        record.population_95_99_years,
        record.population_100_years_or_older
      ];
    }

    var maleAgeGroupSeries = $.map(data.population_by_age_groups.filter(function(record) {
      return record.sex === 'male';
    }), ageGroupsAsArray);
    var femaleAgeGroupSeries = $.map(data.population_by_age_groups.filter(function(record) {
      return record.sex === 'female';
    }), ageGroupsAsArray);
    var negatedFemaleAgeGroupSeries = $.map(femaleAgeGroupSeries, function negate(value) {
      return -value;
    });

    var ageGroups = [
      '0-4', '5-9', '10-14', '15-19', '20-24', '25-29', '30-34', '35-39', '40-44', '45-49', '50-54',
      '55-59', '60-64', '65-69', '70-74', '75-79', '80-84', '85-89', '90-94', '95-99', '100+'
    ];

    $('#ageGroupChart').highcharts({
        chart: { type: 'bar' },
        title: { text: 'Age Groups' },
        xAxis: [{
            categories: ageGroups,
            reversed: false,
            labels: { step: 1 }
        }, { // mirror axis on right side
            opposite: true,
            reversed: false,
            categories: ageGroups,
            linkedTo: 0,
            labels: { step: 1 }
        }],
        tooltip: {
          formatter: function () {
              return '<b>' + this.series.name + ', age ' + this.point.category + '</b><br/>' +
                  'Population: ' + Highcharts.numberFormat(Math.abs(this.point.y), 0);
          }
        },
        yAxis: {
            title: { text: null }
        },
        plotOptions: {
            series: { stacking: 'normal' }
        },
        series: [{
            name: 'Male',
            data: maleAgeGroupSeries
        }, {
            name: 'Female',
            data: negatedFemaleAgeGroupSeries
        }]
    });

    var immigrationSameCantonSeries = $.map(data.immigration_from_same_canton.sort(sortByYear), function(record) {
      return record.immigration;
    });

    var immigrationOtherCantonSeries = $.map(data.immigration_from_other_canton.sort(sortByYear), function(record) {
      return record.immigration;
    });

    var emigrationSameCantonSeries = $.map(data.emigration_from_same_canton.sort(sortByYear), function(record) {
      return -record.emigration;
    });

    var emigrationOtherCantonSeries = $.map(data.emigration_from_other_canton.sort(sortByYear), function(record) {
      return -record.emigration;
    });

    var migrationBalanceSeries = $.map(data.migration_balance.sort(sortByYear), function(record) {
      return record.balance;
    });

    $('#emigrationChart').highcharts({
        chart: { type: 'column' },
        title: { text: 'Emigration' },
        xAxis: {
          categories: years,
        },
        yAxis: {
            title: { text: 'People' }
        },
        plotOptions: {
            column: { stacking: 'normal' }
        },
        //colors: ['#7cb5ec','#434348','#A8D0F6', '#626268'],
        colors: ['#006699', '#66afe9', '#757575', '#454545'],
        series: [{
            name: 'Immigration Same Canton',
            data: immigrationSameCantonSeries
        }, {
            name: 'Immigration Other Canton',
            data: immigrationOtherCantonSeries
        }, {
            name: 'Emigration Same Canton',
            data: emigrationSameCantonSeries
        }, {
            name: 'Emigration Other Canton',
            data: emigrationOtherCantonSeries
        }, {
            name: 'Migration Balance',
            type: 'spline',
            dashStyle: 'shortdot',
            color: '#DC0018',
            data: migrationBalanceSeries
        }]
    });

    function getWorkers(record) {
      return record.workers;
    }
    function getWorkplaces(record) {
      return record.workplaces;
    }


    var primarySectorWorkersSeries = $.map(data.workplaces_by_sector.filter(function(record) {
      return record.sector === 1;
    }), getWorkers);
    var secondarySectorWorkersSeries = $.map(data.workplaces_by_sector.filter(function(record) {
      return record.sector === 2;
    }), getWorkers);
    var tertiarySectorWorkersSeries = $.map(data.workplaces_by_sector.filter(function(record) {
      return record.sector === 3;
    }), getWorkers);

    var primarySectorWorkplacesSeries = $.map(data.workplaces_by_sector.filter(function(record) {
      return record.sector === 1;
    }), getWorkplaces);
    var secondarySectorWorkplacesSeries = $.map(data.workplaces_by_sector.filter(function(record) {
      return record.sector === 2;
    }), getWorkplaces);
    var tertiarySectorWorkplacesSeries = $.map(data.workplaces_by_sector.filter(function(record) {
      return record.sector === 3;
    }), getWorkplaces);

    $('#workplaceSectorChart').highcharts({
        chart: { type: 'pie' },
        title: { text: 'Workplaces by Sector' },
        plotOptions: {
            pie: {
              shadow: false,
              center: ['50%', '50%']
            }
        },
        series: [{
          name: 'Betriebe',
          size: '60%',
          data: [{
            name: 'Betriebe 1. Sektor',
            y: primarySectorWorkplacesSeries[0]
          }, {
            name: 'Betriebe 2. Sektor',
            y: secondarySectorWorkplacesSeries[0]
          }, {
            name: 'Betriebe 3. Sektor',
            y: tertiarySectorWorkplacesSeries[0]
          }]
        }, {
          name: 'Arbeitsplätze',
          size: '80%',
          innerSize: '60%',
          data: [{
            name: 'Arbeitsplätze 1. Sektor',
            y: primarySectorWorkersSeries[0]
          }, {
            name: 'Arbeitsplätze 2. Sektor',
            y: secondarySectorWorkersSeries[0]
          }, {
            name: 'Arbeitsplätze 3. Sektor',
            y: tertiarySectorWorkersSeries[0]
          }]
        }]
    });

    var microWorkersSeries = $.map(data.workplaces_by_size.filter(function(record) {
      return record.workplace_size === 'micro';
    }), getWorkers);
    var smallWorkersSeries = $.map(data.workplaces_by_size.filter(function(record) {
      return record.workplace_size === 'small';
    }), getWorkers);
    var mediumWorkersSeries = $.map(data.workplaces_by_size.filter(function(record) {
      return record.workplace_size === 'medium';
    }), getWorkers);
    var bigWorkersSeries = $.map(data.workplaces_by_size.filter(function(record) {
      return record.workplace_size === 'big';
    }), getWorkers);

    var microWorkplacesSeries = $.map(data.workplaces_by_size.filter(function(record) {
      return record.workplace_size === 'micro';
    }), getWorkplaces);
    var smallWorkplacesSeries = $.map(data.workplaces_by_size.filter(function(record) {
      return record.workplace_size === 'small';
    }), getWorkplaces);
    var mediumWorkplacesSeries = $.map(data.workplaces_by_size.filter(function(record) {
      return record.workplace_size === 'medium';
    }), getWorkplaces);
    var bigWorkplacesSeries = $.map(data.workplaces_by_size.filter(function(record) {
      return record.workplace_size === 'big';
    }), getWorkplaces);

    $('#workplaceSizeChart').highcharts({
        chart: { type: 'pie' },
        title: { text: 'Workplaces by Size' },
        plotOptions: {
            pie: {
              shadow: false,
              center: ['50%', '50%']
            }
        },
        series: [{
          name: 'Betriebe',
          size: '60%',
          data: [{
            name: 'Mikrounternehmen',
            y: microWorkplacesSeries[0]
          }, {
            name: 'Kleinunternehmen',
            y: smallWorkplacesSeries[0]
          }, {
            name: 'Mittlere Unternehmen',
            y: mediumWorkplacesSeries[0]
          }, {
            name: 'Grossunternehmen',
            y: bigWorkplacesSeries[0]
          }]
        }, {
          name: 'Arbeitsplätze',
          size: '80%',
          innerSize: '60%',
          data: [{
            name: 'Mikrounternehmen',
            y: microWorkersSeries[0]
          }, {
            name: 'Kleinunternehmen',
            y: smallWorkersSeries[0]
          }, {
            name: 'Mittlere Unternehmen',
            y: mediumWorkersSeries[0]
          }, {
            name: 'Grossunternehmen',
            y: bigWorkersSeries[0]
          }]
        }]
    });


    });
});
</script>
